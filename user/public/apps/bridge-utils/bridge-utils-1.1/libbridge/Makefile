ifeq ($(CONFIG_BRCM_SUPPORT), 1)
KERNEL_HEADERS=-I$(KERNEL_DIR)/include
ifneq ($(BRCM_502), 1)
KERNEL_HEADERS = -I$(KERNELDIR)/include
else
KERNEL_HEADERS = -idirafter$(KERNELDIR)/include
endif
else
KERNEL_HEADERS=-I/usr/src/linux/include
endif

AR=ar
RANLIB=arm-linux-ranlib

CC=arm-linux-gcc
CFLAGS = -Wall -g $(KERNEL_HEADERS) -DVFIT -DSC_CUSTOMER=\"VFIT\" -DVOX30 -DPRODUCT_TYPE=\"VOX30\" -DFW_VERSION_PREFIX=\"XS\" -DSERCOMM -DSC_OEM=\"SERCOMM\" -DSC_OEM_OUI=\"BC15AC\" -DSC_SSID_PREFIX=\"Vodafone\" -DSPECIAL_ARPPING_URI_DEFINE -DSUPPORT_RESET_ALL_CONFIG -DLANGUAGE_SUPPORT=\"en\" -DSC_OPCO=\"it\" -DCONFIG_SUPPORT_USER_MANAGEMENT_BY_ENDUSER -DCONFIG_SUPPORT_WEEK_DATE -DSC_MANUFACTUREERURL=\"www.sercomm.com\" -DSC_MODELURL=\"www.vodafone.com\" -DCONFIG_SUPPORT_BLOCKING_ACCESS_TO_NEW_DEVICES -DCONFIG_SUPPORT_ARP_TABLE_FILTER -DCONFIG_SUPPORT_DYNAMIC_CLI_PROMOTE -DSC_HW_VERSION=\"v2\" -DSC_OEM_OUI_STRING=\"_VODAFONE_\" -DBRCM_502 -DCONFIG_SUPPORT_PASSWORD_PROTECTION -DMULTI_LEVEL_CONFIG -DCONFIG_SAFE_NETWORK -DCONFIG_SUPPORT_WEB_PRIVOXY -DCONFIG_SCM_SUPPORT -D__SC_BUILD__ -DVOX30_SFP -DSFP_LIB_DEBUG -DVOX_LED_SPEC -DCONFIG_SUPPORT_NEW_LED_BEHAV -DSC_MIXVENDOR_SPT -DSC_VOIP_SUPPORT_PBX -DSC_VOIP_SUPPORT_SILENT_CALL -DSUPPORT_GPON_DEBUG -D_SC_SPI_FIREWALL_ -DSUPPORT_OMCI -DSUPPORT_WIFI -DCONFIG_SUPPORT_WIFI -DSUPPORT_MIMO -DSUPPORT_WSC -DWMF -DSUPPORT_WIFI_BRCM -DSUPPORT_WIFI_11N_CERTIFICATE -DSUPPORT_WIFI_WPS_CERTIFICATE -DSUPPORT_VOIP -DSUPPORT_ROUTER -DSUPPORT_HWNAT -DSUPPORT_MULTIWAN_DOMAIN -DSUPPORT_MULTIWAN_NTP_BINDIP -DSUPPORT_SNMP -DSUPPORT_TR069 -DSUPPORT_SSHD -DSUPPORT_DUALIMAGE -DSCM_PACKET_MARK -DSUPPORT_USB_STORAGE -DSUPPORT_USB_PRINTER -DCONFIG_SUPPORT_IPV6 -DCML_CONVERT_BOOL -DSUPPORT_STATISTICS_NOTIFICATION -DCONFIG_SUPPORT_MEDIA_SERVER -DCONFIG_SUPPORT_DSL -DCONFIG_SUPPORT_VDSL -DCONFIG_SUPPORT_QOS -DCONFIG_SUPPORT_AUTO_SENSE -DCONFIG_SUPPORT_JSON -DCONFIG_BRCM_SUPPORT -DCONFIG_BRCM_SUPPORT_VMUX -DCONFIG_SUPPORT_PRIVATE_HOSTNAME -DHTTP_LOGIN_COOKIE -DCONFIG_SUPPORT_REDIRECT -DCONFIG_SUPPORT_CWMP_RANDOM_PORT -DCONFIG_SUPPORT_WIZARD -DCONFIG_SUPPORT_3G -DCONFIG_SUPPORT_SMS -DCONFIG_SUPPORT_K4203 -DCONFIG_SUPPORT_K5150 -DCONFIG_SUPPORT_3G_BACKUP -DCONFIG_SUPPORT_FIRST_AUTO_DOD -DCONFIG_SUPPORT_VOCS -DSUPPORT_PHONE_PIN_WIZARD -DCONFIG_SUPPORT_WAN_BACKUP -DCONFIG_SUPPORT_ENCRYPTION_AES -DCONFIG_SUPPORT_DEBUG -DCONFIG_SUPPORT_IPTV -DCONFIG_SUPPORT_FON -DCONFIG_SUPPORT_RUNNER -DCONFIG_SUPPORT_L2TP -DCONFIG_SUPPORT_WIFI_MSSID -DCONFIG_USE_DNSMASQ -DCONFIG_SUPPORT_WIFI_5G -DCONFIG_SUPPORT_5G_BRCM -DCONFIG_SUPPORT_STATIC_NAT -DSUPPORT_TWO_FXS -DCONFIG_SUPPORT_WEBAPI -DCONFIG_SUPPORT_UBUS -DCONFIG_SUPPORT_BANDSTEERING -DCONFIG_SUPPORT_WOLAN -DCONFIG_SUPPORT_ENERGY_SAVING -DCONFIG_SUPPORT_SJCL_ENCRYPT -DCONFIG_SUPPORT_CGN -DCONFIG_SUPPORT_SEC_BOOT -DCONFIG_SUPPORT_AUTO_DETECT -DCONFIG_SUPPORT_DSL_FTTH_SWITCH -DCONFIG_SUPPORT_L2TP_CLIENT -DCONFIG_SUPPORT_L2TP_SERVER -DCONFIG_SUPPORT_PPTP_CLIENT -DCONFIG_SUPPORT_PPTP_SERVER -DCONFIG_CRASH_LOG -DCONFIG_SUPPORT_IPSEC_CLIENT -DCONFIG_SUPPORT_NATLOOPBACK -DCONFIG_SUPPORT_BOOSTER_MODE -DCONFIG_PPP_SUPPORT_PADM_PADN -DFW_VERSION_PREFIX=\"XS\" -DSC_OEM_OUI=\"BC15AC\" -DSC_SSID_PREFIX=\"Vodafone\" -DSPECIAL_ARPPING_URI_DEFINE -DSUPPORT_RESET_ALL_CONFIG -DLANGUAGE_SUPPORT=\"en\" -DSC_OPCO=\"it\" -DCONFIG_SUPPORT_USER_MANAGEMENT_BY_ENDUSER -DCONFIG_SUPPORT_WEEK_DATE -DSC_MANUFACTUREERURL=\"www.sercomm.com\" -DSC_MODELURL=\"www.vodafone.com\" -DCONFIG_SUPPORT_BLOCKING_ACCESS_TO_NEW_DEVICES -DCONFIG_SUPPORT_ARP_TABLE_FILTER -DCONFIG_SUPPORT_DYNAMIC_CLI_PROMOTE -DSC_HW_VERSION=\"v2\" -DSC_OEM_OUI_STRING=\"_VODAFONE_\" -DBRCM_502 -DCONFIG_SUPPORT_PASSWORD_PROTECTION -DMULTI_LEVEL_CONFIG -DCONFIG_SAFE_NETWORK -DCONFIG_SUPPORT_WEB_PRIVOXY -DCONFIG_SCM_SUPPORT -D__SC_BUILD__ -DVOX30_SFP -DSFP_LIB_DEBUG -DVOX_LED_SPEC -DCONFIG_SUPPORT_NEW_LED_BEHAV -DSC_MIXVENDOR_SPT -DSC_VOIP_SUPPORT_PBX -DSC_VOIP_SUPPORT_SILENT_CALL -DSUPPORT_GPON_DEBUG -D_SC_SPI_FIREWALL_ -DSUPPORT_OMCI -DSUPPORT_WIFI -DCONFIG_SUPPORT_WIFI -DSUPPORT_MIMO -DSUPPORT_WSC -DWMF -DSUPPORT_WIFI_BRCM -DSUPPORT_WIFI_11N_CERTIFICATE -DSUPPORT_WIFI_WPS_CERTIFICATE -DSUPPORT_VOIP -DSUPPORT_ROUTER -DSUPPORT_HWNAT -DSUPPORT_MULTIWAN_DOMAIN -DSUPPORT_MULTIWAN_NTP_BINDIP -DSUPPORT_SNMP -DSUPPORT_TR069 -DSUPPORT_SSHD -DSUPPORT_DUALIMAGE -DSCM_PACKET_MARK -DSUPPORT_USB_STORAGE -DSUPPORT_USB_PRINTER -DCONFIG_SUPPORT_IPV6 -DCML_CONVERT_BOOL -DSUPPORT_STATISTICS_NOTIFICATION -DCONFIG_SUPPORT_MEDIA_SERVER -DCONFIG_SUPPORT_DSL -DCONFIG_SUPPORT_VDSL -DCONFIG_SUPPORT_QOS -DCONFIG_SUPPORT_AUTO_SENSE -DCONFIG_SUPPORT_JSON -DCONFIG_BRCM_SUPPORT -DCONFIG_BRCM_SUPPORT_VMUX -DCONFIG_SUPPORT_PRIVATE_HOSTNAME -DHTTP_LOGIN_COOKIE -DCONFIG_SUPPORT_REDIRECT -DCONFIG_SUPPORT_CWMP_RANDOM_PORT -DCONFIG_SUPPORT_WIZARD -DCONFIG_SUPPORT_3G -DCONFIG_SUPPORT_SMS -DCONFIG_SUPPORT_K4203 -DCONFIG_SUPPORT_K5150 -DCONFIG_SUPPORT_3G_BACKUP -DCONFIG_SUPPORT_FIRST_AUTO_DOD -DCONFIG_SUPPORT_VOCS -DSUPPORT_PHONE_PIN_WIZARD -DCONFIG_SUPPORT_WAN_BACKUP -DCONFIG_SUPPORT_ENCRYPTION_AES -DCONFIG_SUPPORT_DEBUG -DCONFIG_SUPPORT_IPTV -DCONFIG_SUPPORT_FON -DCONFIG_SUPPORT_RUNNER -DCONFIG_SUPPORT_L2TP -DCONFIG_SUPPORT_WIFI_MSSID -DCONFIG_USE_DNSMASQ -DCONFIG_SUPPORT_WIFI_5G -DCONFIG_SUPPORT_5G_BRCM -DCONFIG_SUPPORT_STATIC_NAT -DSUPPORT_TWO_FXS -DCONFIG_SUPPORT_WEBAPI -DCONFIG_SUPPORT_UBUS -DCONFIG_SUPPORT_BANDSTEERING -DCONFIG_SUPPORT_WOLAN -DCONFIG_SUPPORT_ENERGY_SAVING -DCONFIG_SUPPORT_SJCL_ENCRYPT -DCONFIG_SUPPORT_CGN -DCONFIG_SUPPORT_SEC_BOOT -DCONFIG_SUPPORT_AUTO_DETECT -DCONFIG_SUPPORT_DSL_FTTH_SWITCH -DCONFIG_SUPPORT_L2TP_CLIENT -DCONFIG_SUPPORT_L2TP_SERVER -DCONFIG_SUPPORT_PPTP_CLIENT -DCONFIG_SUPPORT_PPTP_SERVER -DCONFIG_CRASH_LOG -DCONFIG_SUPPORT_IPSEC_CLIENT -DCONFIG_SUPPORT_NATLOOPBACK -DCONFIG_SUPPORT_BOOSTER_MODE -DCONFIG_PPP_SUPPORT_PADM_PADN


prefix=/usr/local
exec_prefix=${prefix}
includedir=${prefix}/include
libdir=${exec_prefix}/lib

libbridge_SOURCES= \
	libbridge_devif.c \
	libbridge_if.c \
	libbridge_init.c \
	libbridge_misc.c 

libbridge_OBJECTS=$(libbridge_SOURCES:.c=.o)

all:	libbridge.a

install: libbridge.a
	mkdir -p $(DESTDIR)$(includedir)
	install -m 644 libbridge.h $(DESTDIR)$(includedir)
	mkdir -p $(DESTDIR)$(libdir)
	install -m 644 libbridge.a $(DESTDIR)$(libdir)


clean:
	rm -f *.o libbridge.a

libbridge.a:	$(libbridge_OBJECTS)
	$(AR) rcs $@ $(libbridge_OBJECTS)
	$(RANLIB) $@

%.o: %.c libbridge.h libbridge_private.h
	$(CC) $(CFLAGS) $(INCLUDE) -c $<

libbridge_compat.o:	libbridge_compat.c if_index.c
	$(CC) $(CFLAGS) -c libbridge_compat.c

